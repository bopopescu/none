
Recovery Manager: Release 11.2.0.4.0 - Production on Thu Apr 16 14:50:42 2015

Copyright (c) 1982, 2011, Oracle and/or its affiliates.  All rights reserved.

RMAN> connect target *
2> connect auxiliary *
3> run{
4> duplicate target database to mfsdb from active database;
5> }
6> exit;
connected to target database: MFSDB (DBID=4084311304)

connected to auxiliary database: MFSDB (not mounted)

Starting Duplicate Db at 2015/04/16 14:50:44
using target database control file instead of recovery catalog
allocated channel: ORA_AUX_DISK_1
channel ORA_AUX_DISK_1: SID=223 device type=DISK

contents of Memory Script:
{
   sql clone "create spfile from memory";
}
executing Memory Script

sql statement: create spfile from memory

contents of Memory Script:
{
   shutdown clone immediate;
   startup clone nomount;
}
executing Memory Script

Oracle instance shut down

connected to auxiliary database (not started)
Oracle instance started

Total System Global Area    1603411968 bytes

Fixed Size                     2253664 bytes
Variable Size                486542496 bytes
Database Buffers            1090519040 bytes
Redo Buffers                  24096768 bytes

contents of Memory Script:
{
   sql clone "alter system set  control_files = 
  ''+DATA/mfsdb/controlfile/current.272.877186279'', ''+FLASH/mfsdb/controlfile/current.256.877182027'' comment=
 ''Set by RMAN'' scope=spfile";
   sql clone "alter system set  db_name = 
 ''MFSDB'' comment=
 ''Modified by RMAN duplicate'' scope=spfile";
   sql clone "alter system set  db_unique_name = 
 ''MFSDB'' comment=
 ''Modified by RMAN duplicate'' scope=spfile";
   shutdown clone immediate;
   startup clone force nomount
   backup as copy current controlfile auxiliary format  '+DATA/mfsdb/controlfile/current.271.877186279';
   restore clone controlfile to  '+FLASH/mfsdb/controlfile/current.256.877182027' from 
 '+DATA/mfsdb/controlfile/current.271.877186279';
   sql clone "alter system set  control_files = 
  ''+DATA/mfsdb/controlfile/current.271.877186279'', ''+FLASH/mfsdb/controlfile/current.256.877182027'' comment=
 ''Set by RMAN'' scope=spfile";
   shutdown clone immediate;
   startup clone nomount;
   alter clone database mount;
}
executing Memory Script

sql statement: alter system set  control_files =   ''+DATA/mfsdb/controlfile/current.272.877186279'', ''+FLASH/mfsdb/controlfile/current.256.877182027'' comment= ''Set by RMAN'' scope=spfile

sql statement: alter system set  db_name =  ''MFSDB'' comment= ''Modified by RMAN duplicate'' scope=spfile

sql statement: alter system set  db_unique_name =  ''MFSDB'' comment= ''Modified by RMAN duplicate'' scope=spfile

Oracle instance shut down

Oracle instance started

Total System Global Area    1603411968 bytes

Fixed Size                     2253664 bytes
Variable Size                486542496 bytes
Database Buffers            1090519040 bytes
Redo Buffers                  24096768 bytes

Starting backup at 2015/04/16 14:51:50
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=66 device type=DISK
channel ORA_DISK_1: starting datafile copy
copying current control file
output file name=/u01/app/oracle/product/11.2.0/db1104/dbs/snapcf_mfsdb.f tag=TAG20150416T145149 RECID=2 STAMP=877186312
channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:07
Finished backup at 2015/04/16 14:51:58

Starting restore at 2015/04/16 14:51:59
allocated channel: ORA_AUX_DISK_1
channel ORA_AUX_DISK_1: SID=205 device type=DISK

channel ORA_AUX_DISK_1: copied control file copy
Finished restore at 2015/04/16 14:52:00

sql statement: alter system set  control_files =   ''+DATA/mfsdb/controlfile/current.271.877186279'', ''+FLASH/mfsdb/controlfile/current.256.877182027'' comment= ''Set by RMAN'' scope=spfile

Oracle instance shut down

connected to auxiliary database (not started)
Oracle instance started

Total System Global Area    1603411968 bytes

Fixed Size                     2253664 bytes
Variable Size                486542496 bytes
Database Buffers            1090519040 bytes
Redo Buffers                  24096768 bytes

database mounted

contents of Memory Script:
{
   set newname for clone datafile  1 to new;
   set newname for clone datafile  2 to new;
   set newname for clone datafile  3 to new;
   set newname for clone datafile  4 to new;
   set newname for clone datafile  5 to new;
   set newname for clone datafile  6 to new;
   backup as copy reuse
   datafile  1 auxiliary format new
   datafile  2 auxiliary format new
   datafile  3 auxiliary format new
   datafile  4 auxiliary format new
   datafile  5 auxiliary format new
   datafile  6 auxiliary format new
   ;
   sql 'alter system archive log current';
}
executing Memory Script

executing command: SET NEWNAME

executing command: SET NEWNAME

executing command: SET NEWNAME

executing command: SET NEWNAME

executing command: SET NEWNAME

executing command: SET NEWNAME

Starting backup at 2015/04/16 14:52:40
using channel ORA_DISK_1
channel ORA_DISK_1: starting datafile copy
input datafile file number=00002 name=/u01/app/oracle/oradata/mfsdb/sysaux01.dbf
output file name=+DATA/mfsdb/datafile/sysaux.268.877186363 tag=TAG20150416T145238
channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:25
channel ORA_DISK_1: starting datafile copy
input datafile file number=00001 name=/u01/app/oracle/oradata/mfsdb/system01.dbf
output file name=+DATA/mfsdb/datafile/system.267.877186389 tag=TAG20150416T145238
channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:25
channel ORA_DISK_1: starting datafile copy
input datafile file number=00003 name=/u01/app/oracle/oradata/mfsdb/undotbs01.dbf
output file name=+DATA/mfsdb/datafile/undotbs1.261.877186415 tag=TAG20150416T145238
channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:15
channel ORA_DISK_1: starting datafile copy
input datafile file number=00005 name=/u01/app/oracle/oradata/mfsdb/zjtdr.dbf
output file name=+DATA/mfsdb/datafile/zjtdr.273.877186429 tag=TAG20150416T145238
channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:15
channel ORA_DISK_1: starting datafile copy
input datafile file number=00006 name=/u01/app/oracle/oradata/mfsdb/tbs_rman01.dbf
output file name=+DATA/mfsdb/datafile/tbs_rman.269.877186445 tag=TAG20150416T145238
channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:07
channel ORA_DISK_1: starting datafile copy
input datafile file number=00004 name=/u01/app/oracle/oradata/mfsdb/users01.dbf
output file name=+DATA/mfsdb/datafile/users.257.877186453 tag=TAG20150416T145238
channel ORA_DISK_1: datafile copy complete, elapsed time: 00:00:01
Finished backup at 2015/04/16 14:54:12

sql statement: alter system archive log current

contents of Memory Script:
{
   backup as copy reuse
   archivelog like  "/u01/app/oracle/flash_recovery_area/mfsdb/MFSDB/archivelog/2015_04_16/o1_mf_1_193_blyq4nwq_.arc" auxiliary format 
 "+FLASH"   ;
   catalog clone start with  "+FLASH";
   switch clone datafile all;
}
executing Memory Script

Starting backup at 2015/04/16 14:54:17
using channel ORA_DISK_1
channel ORA_DISK_1: starting archived log copy
input archived log thread=1 sequence=193 RECID=75 STAMP=877186454
output file name=+FLASH/mfsdb/archivelog/2015_04_16/thread_1_seq_193.261.877186459 RECID=0 STAMP=0
channel ORA_DISK_1: archived log copy complete, elapsed time: 00:00:01
Finished backup at 2015/04/16 14:54:19

searching for all files that match the pattern +FLASH

List of Files Unknown to the Database
=====================================
File Name: +flash/MFSDB/ARCHIVELOG/2015_04_16/thread_1_seq_193.261.877186459
File Name: +flash/MFSDB/ONLINELOG/group_1.257.877182031
File Name: +flash/MFSDB/ONLINELOG/group_2.258.877182031
File Name: +flash/MFSDB/ONLINELOG/group_3.259.877182151
File Name: +flash/MFSDB/ONLINELOG/group_4.260.877182151
cataloging files...
cataloging done

List of Cataloged Files
=======================
File Name: +flash/MFSDB/ARCHIVELOG/2015_04_16/thread_1_seq_193.261.877186459

List of Files Which Where Not Cataloged
=======================================
File Name: +flash/MFSDB/ONLINELOG/group_1.257.877182031
  RMAN-07518: Reason: Foreign database file DBID: 4087150795  Database Name: MFSDB
File Name: +flash/MFSDB/ONLINELOG/group_2.258.877182031
  RMAN-07518: Reason: Foreign database file DBID: 4087150795  Database Name: MFSDB
File Name: +flash/MFSDB/ONLINELOG/group_3.259.877182151
  RMAN-07518: Reason: Foreign database file DBID: 4087150795  Database Name: MFSDB
File Name: +flash/MFSDB/ONLINELOG/group_4.260.877182151
  RMAN-07518: Reason: Foreign database file DBID: 4087150795  Database Name: MFSDB

datafile 1 switched to datafile copy
input datafile copy RECID=2 STAMP=877186460 file name=+DATA/mfsdb/datafile/system.267.877186389
datafile 2 switched to datafile copy
input datafile copy RECID=3 STAMP=877186460 file name=+DATA/mfsdb/datafile/sysaux.268.877186363
datafile 3 switched to datafile copy
input datafile copy RECID=4 STAMP=877186460 file name=+DATA/mfsdb/datafile/undotbs1.261.877186415
datafile 4 switched to datafile copy
input datafile copy RECID=5 STAMP=877186460 file name=+DATA/mfsdb/datafile/users.257.877186453
datafile 5 switched to datafile copy
input datafile copy RECID=6 STAMP=877186460 file name=+DATA/mfsdb/datafile/zjtdr.273.877186429
datafile 6 switched to datafile copy
input datafile copy RECID=7 STAMP=877186460 file name=+DATA/mfsdb/datafile/tbs_rman.269.877186445

contents of Memory Script:
{
   set until scn  7617761;
   recover
   clone database
    delete archivelog
   ;
}
executing Memory Script

executing command: SET until clause

Starting recover at 2015/04/16 14:54:21
allocated channel: ORA_AUX_DISK_1
channel ORA_AUX_DISK_1: SID=223 device type=DISK

starting media recovery

archived log for thread 1 with sequence 193 is already on disk as file +FLASH/mfsdb/archivelog/2015_04_16/thread_1_seq_193.261.877186459
archived log file name=+FLASH/mfsdb/archivelog/2015_04_16/thread_1_seq_193.261.877186459 thread=1 sequence=193
media recovery complete, elapsed time: 00:00:00
Finished recover at 2015/04/16 14:54:27
Oracle instance started

Total System Global Area    1603411968 bytes

Fixed Size                     2253664 bytes
Variable Size                486542496 bytes
Database Buffers            1090519040 bytes
Redo Buffers                  24096768 bytes

contents of Memory Script:
{
   sql clone "alter system set  db_name = 
 ''MFSDB'' comment=
 ''Reset to original value by RMAN'' scope=spfile";
   sql clone "alter system reset  db_unique_name scope=spfile";
   shutdown clone immediate;
   startup clone nomount;
}
executing Memory Script

sql statement: alter system set  db_name =  ''MFSDB'' comment= ''Reset to original value by RMAN'' scope=spfile

sql statement: alter system reset  db_unique_name scope=spfile

Oracle instance shut down

connected to auxiliary database (not started)
Oracle instance started

Total System Global Area    1603411968 bytes

Fixed Size                     2253664 bytes
Variable Size                486542496 bytes
Database Buffers            1090519040 bytes
Redo Buffers                  24096768 bytes
sql statement: CREATE CONTROLFILE REUSE SET DATABASE "MFSDB" RESETLOGS ARCHIVELOG 
  MAXLOGFILES     16
  MAXLOGMEMBERS      3
  MAXDATAFILES      100
  MAXINSTANCES     8
  MAXLOGHISTORY      292
 LOGFILE
  GROUP   1  SIZE 50 M ,
  GROUP   2  SIZE 50 M ,
  GROUP   3  SIZE 50 M 
 DATAFILE
  '+DATA/mfsdb/datafile/system.267.877186389'
 CHARACTER SET ZHS16GBK


contents of Memory Script:
{
   set newname for clone tempfile  1 to new;
   set newname for clone tempfile  2 to new;
   switch clone tempfile all;
   catalog clone datafilecopy  "+DATA/mfsdb/datafile/sysaux.268.877186363", 
 "+DATA/mfsdb/datafile/undotbs1.261.877186415", 
 "+DATA/mfsdb/datafile/users.257.877186453", 
 "+DATA/mfsdb/datafile/zjtdr.273.877186429", 
 "+DATA/mfsdb/datafile/tbs_rman.269.877186445";
   switch clone datafile all;
}
executing Memory Script

executing command: SET NEWNAME

executing command: SET NEWNAME

renamed tempfile 1 to +data in control file
renamed tempfile 2 to +data in control file

cataloged datafile copy
datafile copy file name=+DATA/mfsdb/datafile/sysaux.268.877186363 RECID=1 STAMP=877186524
cataloged datafile copy
datafile copy file name=+DATA/mfsdb/datafile/undotbs1.261.877186415 RECID=2 STAMP=877186524
cataloged datafile copy
datafile copy file name=+DATA/mfsdb/datafile/users.257.877186453 RECID=3 STAMP=877186524
cataloged datafile copy
datafile copy file name=+DATA/mfsdb/datafile/zjtdr.273.877186429 RECID=4 STAMP=877186524
cataloged datafile copy
datafile copy file name=+DATA/mfsdb/datafile/tbs_rman.269.877186445 RECID=5 STAMP=877186524

datafile 2 switched to datafile copy
input datafile copy RECID=1 STAMP=877186524 file name=+DATA/mfsdb/datafile/sysaux.268.877186363
datafile 3 switched to datafile copy
input datafile copy RECID=2 STAMP=877186524 file name=+DATA/mfsdb/datafile/undotbs1.261.877186415
datafile 4 switched to datafile copy
input datafile copy RECID=3 STAMP=877186524 file name=+DATA/mfsdb/datafile/users.257.877186453
datafile 5 switched to datafile copy
input datafile copy RECID=4 STAMP=877186524 file name=+DATA/mfsdb/datafile/zjtdr.273.877186429
datafile 6 switched to datafile copy
input datafile copy RECID=5 STAMP=877186524 file name=+DATA/mfsdb/datafile/tbs_rman.269.877186445

contents of Memory Script:
{
   Alter clone database open resetlogs;
}
executing Memory Script

database opened
Finished Duplicate Db at 2015/04/16 14:55:32

Recovery Manager complete.
